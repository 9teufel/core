var Isotope={};(function(){"use strict";Isotope.toggleCheckboxGroup=function(c,d){var b=document.id(c).className;var a=document.id(c).checked?"checked":"";if(b=="tl_checkbox"){$$("#"+d+" .tl_checkbox").each(function(e){if(!e.disabled){e.checked=a}})}else{if(b=="tl_tree_checkbox"){$$("#"+d+" .parent .tl_tree_checkbox").each(function(e){if(!e.disabled){e.checked=a}})}}Backend.getScrollOffset()};Isotope.openModalGroupSelector=function(b){var c=b||{};var a=(window.getSize().y-180).toInt();if(!c.height||c.height>a){c.height=a}var d=new SimpleModal({width:c.width,btn_ok:Contao.lang.close,draggable:false,overlayOpacity:0.5,onShow:function(){document.body.setStyle("overflow","hidden")},onHide:function(){document.body.setStyle("overflow","auto")}});d.addButton(Contao.lang.close,"btn",function(){this.hide()});d.addButton(Contao.lang.apply,"btn primary",function(){var k=[],j=null,e=window.frames;for(var g=0;g<e.length;g++){if(e[g].name=="simple-modal-iframe"){j=e[g];break}}if(j===null){alert("Could not find the SimpleModal frame");return}var f=j.document.getElementById("tl_listing");if(!f){f=j.document.getElementById("tl_select")}var h=f.getElementsByTagName("input");for(var g=0;g<h.length;g++){if(!h[g].checked||h[g].id.match(/^check_all_/)){continue}if(!h[g].id.match(/^reset_/)){k.push(h[g].get("value"))}}new Request.Contao({evalScripts:false,onRequest:AjaxRequest.displayBox(Contao.lang.loading+" …"),onSuccess:function(i,l){if(i!=""){window.location.href=i}}}).post({action:c.action,value:k[0],redirect:c.redirect,REQUEST_TOKEN:Contao.request_token});this.hide();if(c.trigger){c.trigger.fireEvent("closeModal")}});d.show({title:c.title,contents:'<iframe src="'+c.url+'" name="simple-modal-iframe" width="100%" height="'+c.height+'" frameborder="0"></iframe>',model:"modal"});return d};Isotope.openModalPageSelector=function(b){var c=b||{};var a=(window.getSize().y-180).toInt();if(!c.height||c.height>a){c.height=a}var d=new SimpleModal({width:c.width,btn_ok:Contao.lang.close,draggable:false,overlayOpacity:0.5,onShow:function(){document.body.setStyle("overflow","hidden")},onHide:function(){document.body.setStyle("overflow","auto")}});d.addButton(Contao.lang.close,"btn",function(){this.hide()});d.addButton(Contao.lang.apply,"btn primary",function(){var k=0,j=null,e=window.frames;for(var g=0;g<e.length;g++){if(e[g].name=="simple-modal-iframe"){j=e[g];break}}if(j===null){alert("Could not find the SimpleModal frame");return}var f=j.document.getElementById("tl_listing");if(!f){f=j.document.getElementById("tl_select")}var h=f.getElementsByTagName("input");for(var g=0;g<h.length;g++){if(!h[g].checked||h[g].id.match(/^check_all_/)){continue}if(!h[g].id.match(/^reset_/)){k=h[g].get("value")}}new Request.Contao({evalScripts:false,onRequest:AjaxRequest.displayBox(Contao.lang.loading+" …"),onSuccess:function(i,l){if(i!=""){window.location.href=i}}}).post({action:c.action,value:k,redirect:c.redirect,REQUEST_TOKEN:Contao.request_token});this.hide()});d.show({title:c.title,contents:'<iframe src="'+c.url+'" name="simple-modal-iframe" width="100%" height="'+c.height+'" frameborder="0"></iframe>',model:"modal"});return d};Isotope.addInteractiveHelp=function(){new Tips.Contao("a.tl_tip",{offset:{x:9,y:21},text:function(a){return a.get("longdesc")}})};Isotope.inheritFields=function(a,b){var c=false;a.each(function(f,g){var j=document.id(("ctrl_"+f));if(j){var h=j.getParent("div").getFirst("h3");if(!h&&j.match(".tl_checkbox_single_container")){h=j}if(!h){c=true;return}h.addClass("inherit");var d=document.id("ctrl_inherit").getFirst(("input[value="+f+"]"));d.setStyle("float","right").inject(h);document.id("ctrl_inherit").getFirst(("label[for="+d.get("id")+"]")).setStyles({"float":"right","padding-right":"5px","font-weight":"normal"}).set("text",b).inject(h);d.addEvent("change",function(l){var i=document.id(("ctrl_"+l.target.get("value")));if(i.match(".tl_checkbox_single_container")){i.getFirst("input[type=checkbox]").disabled=l.target.checked}else{if(i.getPrevious()&&i.getPrevious().hasClass("mce-tinymce")){i.getPrevious().setStyle("display",(l.target.checked?"none":"inherit"))}else{i.setStyle("display",(l.target.checked?"none":"inherit"))}try{i.getNext(":not(.tl_tip):not(script)").setStyle("display",(l.target.checked?"none":"inherit"))}catch(m){}}});if(j.match(".tl_checkbox_single_container")){j.getFirst("input[type=checkbox]").disabled=d.checked}else{j.setStyle("display",(d.checked?"none":"inherit"));try{j.getNext(":not(.tl_tip):not(script)").setStyle("display",(d.checked?"none":"inherit"))}catch(k){}}}});if(!c){document.id("ctrl_inherit").getParent("div").setStyle("display","none")}};Isotope.makeSelectExtendable=function(){var a={};document.getElements("select.extendable").forEach(function(b){var d=b.value;var c=b.getParent("table").id;a[c]=a[c]||[];a[c].push(b);b.grab(new Element("option",{text:"Add …",value:"extendSelect"})).addEvent("change",function(g){if(b.value=="extendSelect"){var f=prompt("Please enter the new group name.");if(f!=""){if(c&&a[c]){a[c].forEach(function(e){new Element("option",{text:f,value:f}).inject(e.getLast(),"before")})}else{new Element("option",{text:f,value:f}).inject(b.getLast(),"before")}b.value=f;d=f}else{b.value=d}b.fireEvent("change")}else{d=b.value}})})};Isotope.makeParentViewSortable=function(a){var c=new Scroller(document.getElement("body"),{onChange:function(d,e){this.element.scrollTo(this.element.getScroll().x,e)}});var b=new Sortables(a,{contstrain:true,opacity:0.6,onStart:function(){c.start()},onComplete:function(){c.stop()},onSort:function(e){var h=e.getFirst("div"),f,d,g;if(!h){return}if(h.hasClass("wrapper_start")){if((f=e.getPrevious("li"))&&(g=f.getFirst("div"))){g.removeClass("indent")}if((d=e.getNext("li"))&&(g=d.getFirst("div"))){g.addClass("indent")}}else{if(h.hasClass("wrapper_stop")){if((f=e.getPrevious("li"))&&(g=f.getFirst("div"))){g.addClass("indent")}if((d=e.getNext("li"))&&(g=d.getFirst("div"))){g.removeClass("indent")}}else{if(h.hasClass("indent")){if((f=e.getPrevious("li"))&&(g=f.getFirst("div"))&&g.hasClass("wrapper_stop")){h.removeClass("indent")}else{if((d=e.getNext("li"))&&(g=d.getFirst("div"))&&g.hasClass("wrapper_start")){h.removeClass("indent")}}}else{if((f=e.getPrevious("li"))&&(g=f.getFirst("div"))&&g.hasClass("wrapper_start")){h.addClass("indent")}else{if((d=e.getNext("li"))&&(g=d.getFirst("div"))&&g.hasClass("wrapper_stop")){h.addClass("indent")}}}}}},handle:".drag-handle"});b.active=false;b.addEvent("start",function(){b.active=true});b.addEvent("complete",function(f){if(!b.active){return}var h,e,g,d;if(f.getPrevious("li")){h=f.get("id").replace(/li_/,"");e=f.getPrevious("li").get("id").replace(/li_/,"");g=window.location.search.replace(/id=[0-9]*/,"id="+h)+"&act=cut&mode=1&page_id="+e;d=window.location.href.replace(/\?.*$/,"");new Request.Contao({url:d+g,followRedirects:false}).get()}else{if(f.getParent("ul")){h=f.get("id").replace(/li_/,"");e=f.getParent("ul").get("id").replace(/ul_/,"");g=window.location.search.replace(/id=[0-9]*/,"id="+h)+"&act=cut&mode=2&page_id="+e;d=window.location.href.replace(/\?.*$/,"");new Request.Contao({url:d+g,followRedirects:false}).get()}}})}})();Isotope.MediaManager={};(function(){Isotope.MediaManager.init=function(c,k,j){var b=$("ctrl_"+k);var a=[];var h,e,m,g,f,l;var d={element:document.id(c),request:{endpoint:window.location.href,inputName:k,params:{action:"uploadMediaManager",name:k,REQUEST_TOKEN:Contao.request_token}},failedUploadTextDisplay:{mode:"custom",maxChars:50,responseProperty:"error"},validation:{allowedExtensions:j},callbacks:{onUpload:function(){AjaxRequest.displayBox(Contao.lang.loading+" …")},onComplete:function(o,n,i){if(!i.success){AjaxRequest.hideBox();return}if(i.file){a.push(i.file)}if(this.getInProgress()>0){return}l={};g=b.getElements('[name^="'+k+'"]');for(e=0;e<g.length;e++){h=g[e].get("name").split("[");if(h.length!=3){continue}m=h[1].replace("]","");if(!l[m]){l[m]={}}f=h[2].replace("]","");if(g[e].get("type")=="radio"){if(!l[m][f]){l[m][f]=""}if(g[e].get("checked")){l[m][f]=g[e].get("value")}}else{l[m][f]=g[e].get("value")}}new Request.Contao({evalScripts:false,onSuccess:function(p,q){b.getElement("div").set("html",q.content);q.javascript&&Browser.exec(q.javascript);AjaxRequest.hideBox();window.fireEvent("ajax_change")}}).post({action:"reloadMediaManager",name:k,value:l,files:a,REQUEST_TOKEN:Contao.request_token});a=[]}}};return new qq.FineUploader(d)};Isotope.MediaManager.makeSortable=function(){$$(".tl_mediamanager .sortable").each(function(a){new Sortables(a,{contstrain:true,opacity:0.6,handle:".drag-handle",onComplete:function(){Isotope.MediaManager.resort(a)}})})};Isotope.MediaManager.act=function(c,f,g){var d=document.id(g).getElement("table");var a=d.getFirst("tbody");var b=document.id(c).getParent("tr");var e=a.getChildren();Backend.getScrollOffset();switch(f){case"up":b.getPrevious()?b.injectBefore(b.getPrevious()):b.injectInside(a);break;case"down":b.getNext()?b.injectAfter(b.getNext()):b.injectBefore(a.getFirst());break;case"delete":b.destroy();break}Isotope.MediaManager.resort(a)};Isotope.MediaManager.resort=function(d){var f=d.getChildren(),b,a,g,e,c;for(e=0;e<f.length;e++){a=f[e].getElements("[name]");for(c=0;c<a.length;c++){a[c].name=a[c].name.replace(/\[[0-9]+\]/g,"["+e+"]");a[c].id=a[c].id.replace(/_[0-9]+/g,"_"+e)}g=f[e].getElements("label");for(c=0;c<g.length;c++){g[c].set("for",g[c].get("for").replace(/_[0-9]+/g,"_"+e))}}}})();window.addEvent("domready",function(){Isotope.addInteractiveHelp();Isotope.makeSelectExtendable();Isotope.MediaManager.makeSortable()}).addEvent("structure",function(){Isotope.addInteractiveHelp()});window.addEvent("ajax_change",function(){Isotope.addInteractiveHelp();Isotope.MediaManager.makeSortable()});